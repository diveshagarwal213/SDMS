<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDMS Data Management</title>
    <script src="jquery.js"></script>
    
</head>
<body>
    <h1 class="heading"> <a href="index.php">SDMS</a> New Data Management</h1>
    <div id="formDiv">
        <h2 class="heading">Insert New Data</h2>
        <form id="topicText">
            <div id="one1">
                <label for="Cname">Cource Name</label> 
                <select  id="Cname" name="c_id">
                    <option value="">select Cource name</option>     
                </select>
                <div id="cyear">
                    <p>select Year</p>
                    <label for="Cyear_1">1</label>
                    <input type="radio" id="Cyear_1" name="year" value="1">
                    <label for="Cyear_2">2</label>
                    <input type="radio" id="Cyear_2" name="year" value="2">
                    <label for="Cyear_3">3</label>
                    <input type="radio" id="Cyear_3" name="year" value="3">
                    <label for="Cyear_4">4</label>
                    <input type="radio" id="Cyear_4" name="year" value="4">
                </div>
            </div>
            <div id="two2">
                <label for="Csubject">subjects</label> 
                <select  id="Csubject" name="sub_id">
                    <option value="">select subject</option>     
                </select>
                <div id="sunit">
                    <p>select subject unit</p>
                    <label for="unit_1">1</label>
                    <input type="radio" id="unit_1" name="unit" value="1">
                    <label for="unit_2">2</label>
                    <input type="radio" id="unit_2" name="unit" value="2">
                    <label for="unit_3">3</label>
                    <input type="radio" id="unit_3" name="unit" value="3">
                    <label for="unit_4">4</label>
                    <input type="radio" id="unit_4" name="unit" value="4">
                </div>
            </div>
            <label for="title">Toipc Title<span class="orange">*</span></label>
            <input type="text" id="title" name="title">
            <br>
            
            <label for="h_one">First Heading<span class="orange">*</span></label>
            <input type="text" id="h_one" name="h_one" >
            <br>
            <label for="t_one">Text body</label> <br>
            <textarea id="t_one" cols="30" rows="10" name="t_one"></textarea>
            <br>
            
            <label for="h_two">second Heading</label>
            <input type="text" id="h_two" name="h_two">
            <br>
            <label for="t_two">Text body 2</label>
            <br> 
            <textarea id="t_two" cols="30" rows="10" name="t_two"></textarea>
            <br>
            
            <label for="h_three">third Heading</label>
            <input type="text" id="h_three" name="h_three">
            <br>
            <label for="t_three">Text body 3</label>
            <br>
            <textarea  id="t_three" cols="30" rows="10" name="t_three"></textarea>
            <br>
            <input type="submit" value="save ok" id="save_TopicText">

        </form>
            <div id="success"></div>
            <div id="error"></div>
            <div id="data" ></div>
            <!--<label for="Tbody">Title Body<span class="orange">*</span></label>
                <button id="save_TopicText">save</button>
            <textarea  id="Tbody"></textarea>
            <input type="submit" id="saveButton" class="Button1" value="Submit">
    </div>
    <div id="searchDiv">
        <h2 class="heading">Search Topic</h2>
        <input type="text" id="searchBox">
    </div>
    <div id="loadDiv">
        <table id="loadTable">
            <tr>
                <th>ID</th>
                <th>Cource Name</th>
                <th>Cource Year</th>
                <th>Cource Subject</th>
                <th>Subject Unit</th>
                <th>Title</th>
                <th>Update</th>
                <th>Delete</th>
            </tr>
            <tbody id="tableData">
                
            </tbody>
        </table>
    </div>-->

    <script>
        $(document).ready(function(){
            
            //global variables
            var url = "http://localhost/sdms/";
            var c_id ;
            var c_year ;
            var s_name;
            var s_unit ;

            // function form data to json object
            function jsonData(form_id) {
                var form_data = $(form_id).serializeArray(); //get all form values in array
                var obj ={};
                for (let a = 0; a < form_data.length; a++) { // convert form_data array into javaScript-Object
                    obj[form_data[a].name] = form_data[a].value;
                }
                var json_data = JSON.stringify(obj); //convert java script-object into Json
                //console.log(json_data);
                return json_data;
            }

            //load cources
            function load_cources() {
                
                $.ajax({
                    url :  url + "php_files/databaseApi.php?api_id=9",
                    type : "GET",
                    success: function(data){
                        //console.log(data);
                        if (data.status == false) {
                            $("#Cname").html("<option value =''> no record found </option>");
                            console.log(data.message);
                        }else{
                            $.each(data, function(key, value){
                                $("#Cname").append("<option value ='" + value.cid + "'>" + value.cname + "</option>");
                            });
                        }
                        
                    }
                });
            } 
            load_cources();

            //load subjects(s_name)
            function load_subjects() {
                
                var obj = {c_id: c_id, c_year: c_year};
                var d = JSON.stringify(obj);
                $.ajax({
                    url :  url + "php_files/databaseApi.php?api_id=10",
                    type : "POST",
                    data : d,
                    success: function(data){
                       if (data.status == false) {
                        $("#Csubject").html("<option value =''> no record found </option>");
                        console.log(data.message);
                       }else{
                            $.each(data, function(key, value){
                                $("#Csubject").html("<option  value ='" + value.subid + "'>" + value.sub_name + "</option>");
                            });
                            //console.log(data);
                       }
                    }
                });
            }

            // message function
            function message(message,status) { // message("display error or succes message", false);
                if (status == true) {
                    $("#success").html(message).slideDown();
                    $("#error").slideUp();
                    setTimeout(function () {
                        $("#success").slideUp();
                    },5000)
                }else if(status == false){
                    $("#error").html(message).slideDown();
                    $("#success").slideUp();
                    setTimeout(function () {
                        $("#error").slideUp();
                    },5000)
                }
            }

            // get selected cName id into  c_id
            $('#Cname').on('change', function () {
                c_id = this.value;        
                //var c_yearText = $(this).find('option').filter(':selected').text();        
                //console.log(c_id,c_yearText);
            });

            //get cource_year and subject_unit into c_year & s_unit 
            $("input[type='radio']").click(function(){
                c_year = $("input[name='year']:checked").val();
                s_unit = $("input[name='unit']:checked").val();
                //console.log(c_year,s_unit);
            });

            // get subjects name according to selected  cource year
            $("#cyear input[type='radio']").change(function () {
                load_subjects();
            })
            
            // insert topic_text on click save button
            $("#save_TopicText").on("click", function (e) {
                e.preventDefault();

                var j = jsonData("#topicText");
                console.log(j);
                $.ajax({
                    url : "http://localhost/sdms/php_files/databaseApi_insert.php?api_insert_id=4",
                    type : "POST",
                    data : j,
                    success: function(data){
                        console.log(data);
                    }
                });
                
            });

            
        });//ready
        

    </script>

</body>
</html>