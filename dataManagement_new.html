<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDMS Data Management</title>
    <script src="jquery.js"></script>
    <link rel="stylesheet" href="css/dataManagementNew.css">
    <style>
        option{
            background-color: rgb(51, 38, 66);
        }
    </style>
    
</head>
<body>
    <h1 class="heading"> <a href="index.php">SDMS</a> New Data Management</h1>
    <h2 class="heading">Insert New Data</h2> 
    <div id="formDiv">
        <form id="topicText" autocomplete="off">
            
            <div id="two" >
                <label for="title">Toipc Title<span class="orange">*</span></label>
                <input type="text" id="title" name="title">
                <br>
                
                <label for="h_one">First Heading<span class="orange">*</span></label>
                <input type="text" id="h_one" name="h_one" >
                <br>
                <label for="t_one">Text body</label> <br>
                <textarea id="t_one" cols="30" rows="10" name="t_one"></textarea>
                <br>
                <label for="youtube">YouTube code </label>
                <input type="text" id="youtube" name="youtube">
                <br>
                <div id="two1">
                    <label for="h_two">second Heading</label>
                    <input type="text" id="h_two" name="h_two">
                    <br>
                    <label for="t_two">Text body 2</label>
                    <br> 
                    <textarea id="t_two" cols="30" rows="10" name="t_two"></textarea>
                    <br>
                    
                    <label for="h_three">third Heading</label>
                    <input type="text" id="h_three" name="h_three">
                    <br>
                    <label for="t_three">Text body 3</label>
                    <br>
                    <textarea  id="t_three" cols="30" rows="10" name="t_three"></textarea>
                    <br>
                </div>
                <input type="submit" value="save" id="save_TopicText">
            </div>
        </form>
    <button id="more">More Space</button>
    </div>
    <div id="message_box">
        <div id="success"></div>
        <div id="error"></div>
    </div>
        

    <div id="update_form">
        <h2 class="heading">Update Data</h2> 
        <form id="update_topicText" autocomplete="off">

            <div id="one">
                <div id="one1">
                    <label for="up_Cname">Cource Name</label> 
                    <select  id="up_Cname">
                        <option value="">select Cource name</option>     
                    </select>
                    <div id="update_cyear">
                        <label for="up_cyear">Cource year</label>
                    <input type="number" id="up_cyear" min="0" max="4">
                    </div>
                </div>
                <div id="one2">
                    <label for="up_subject">subjects</label> 
                    <select  id="up_subject" >
                        <option value="">select subject</option>     
                    </select>
                    <div id="update_sunit">
                        <label for="up_sunit">subject Unit</label>
                        <input type="number" id="up_sunit" min="0" max="5">
                    </div>
                </div>
            </div>
            <label for="up_title">Toipc Title<span class="orange">*</span></label>
            <input type="text" id="up_title">
            <br>
            
            <label for="up_h_one">First Heading<span class="orange">*</span></label>
            <input type="text" id="up_h_one" >
            <br>
            <label for="up_t_one">Text body</label> <br>
            <textarea id="up_t_one" cols="30" rows="10" ></textarea>
            <br>
            <label for="up_youtube">YouTube code </label>
            <input type="text" id="up_youtube" name="youtube">
            <br>
            <label for="up_h_two">second Heading</label>
            <input type="text" id="up_h_two" >
            <br>
            <label for="up_t_two">Text body 2</label>
            <br> 
            <textarea id="up_t_two" cols="30" rows="10" ></textarea>
            <br>
            
            <label for="up_h_three">third Heading</label>
            <input type="text" id="up_h_three" >
            <br>
            <label for="up_t_three">Text body 3</label>
            <br>
            <textarea  id="up_t_three" cols="30" rows="10" name="t_three"></textarea>
            <br>
            <input type="submit" value="update" id="update_TopicText">
        </form>
        <button id="cancle" >Cancle</button>
    </div>

    <div id="searchDiv">
        <h2 class="heading">Search Topic</h2>
        <input type="text" id="searchBox">
    </div>

    <div id="loadDiv">
        <table id="loadTable">
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Update</th>
                <th>Delete</th>
            </tr>
            <tbody id="tableData">
                
            </tbody>
        </table>
    </div>

    

    <script src="functions.js"></script>
    <script>
        $(document).ready(function(){

            //global variables
            var url = "http://localhost/sdms/";
            var c_id = null;
            var c_year = null;
            var s_id = null;
            var s_unit = null;
            var topic_by = null;
            var update_id =null;
            var up_cid = null;
            var up_subid = null;

            //loadData
            function loadTable(){
                $("#tableData").html("");
                $.ajax({
                    url:"http://localhost/sdms/php_files/databaseApi.php?api_id=5",
                    type: "GET",
                    success: function(data){
                        //console.log(data);
                        if(data.status == false){
                            $("#tableData").append("<tr><td><h2>" + data.message + "</h2></td></tr>"); 
                        }else{
                            $.each(data, function(key, value){
                                $("#tableData").append("<tr><td>" + value.tid + "</td><td>" + value.title + "</td>"
                                    + "<td> <button class = 'updateBtn' data-idupdate = '" + value.tid + "'>Update</button> </td>" + "<td> <button class = 'deleteBtn' data-iddelete = '" + value.tid + "'>Delete</button> </td>" );
                            });
                        }
                    }
                });
            }
            loadTable();


            // insert topic_text on click save button
            $("#save_TopicText").on("click", function (e) {
                e.preventDefault();

                var title = $("#title").val();
                var h_one = $("#h_one").val();
                var h_two = $("#h_two").val();
                var h_three = $("#h_three").val();
                var t_one = $("#t_one").val();
                var t_two = $("#t_two").val();
                var t_three = $("#t_three").val();
                var youtube = $("#youtube").val();
                var obj = {title:title,h_one:h_one,h_two:h_two,h_three:h_three,t_one:t_one,t_two:t_two,t_three:t_three,topic_by:topic_by,youtube:youtube};
                
                var j = JSON.stringify(obj);
                //var j = jsonData("#topicText"); (not working [console bug] )
                //console.log(j);
                $.ajax({
                    url : "http://localhost/sdms/php_files/databaseApi_insert.php?api_insert_id=5",
                    type : "POST",
                    data : j,
                    success : function(data){
                        //console.log(data);
                        if (data.status == false) {
                            message(data.message,false);
                            console.log(data);
                        }else if(data.status == true){
                            message("Data inserted successfully.",true);
                            loadTable();
                            $("#topicText").trigger("reset");
                        }
                    }
                });
                
            });

            //fetch data for update and pre_set values for change
            $(document).on("click",".updateBtn", function () {
                update_id = $(this).data("idupdate");
                var obj = {id:update_id};
                var Jdata = JSON.stringify(obj);
                $("#update_topicText").trigger("reset");
                $.ajax({
                    url:"http://localhost/sdms/php_files/databaseApi.php?api_id=3",
                    type: "POST",
                    data: Jdata,
                    success: function(data){
                        //console.log(data);
                        $("#up_title").val(data[0].title);
                        $("#up_h_one").val(data[0].h_one);
                        $("#up_h_two").val(data[0].h_two);
                        $("#up_h_three").val(data[0].h_three);
                        $("#up_t_one").val(data[0].t_one);
                        $("#up_t_two").val(data[0].t_two);
                        $("#up_t_three").val(data[0].t_three);       
                        $("#up_youtube").val(data[0].youtube_link);       
                    }
                });
                $("#update_form").slideDown(1000);
            });

            // update data
            $("#update_TopicText").on("click", function (e) {
                e.preventDefault();
                var title = $("#up_title").val();
                var h_one = $("#up_h_one").val();
                var h_two = $("#up_h_two").val();
                var h_three = $("#up_h_three").val();
                var t_one = $("#up_t_one").val();
                var t_two = $("#up_t_two").val();
                var t_three = $("#up_t_three").val();
                var youtube = $("#up_youtube").val();
                
                var obj = {id:update_id, title:title,h_one:h_one,h_two:h_two,h_three:h_three,t_one:t_one,t_two:t_two,t_three:t_three,youtube:youtube};
                var Jdata = JSON.stringify(obj);
                //console.log(Jdata);

                $.ajax({
                    url : "http://localhost/sdms/php_files/databaseApi_insert.php?api_insert_id=6",
                    type : "POST",
                    data : Jdata,
                    success : function(data){
                        //console.log(data);
                        if (data.status == false) {
                            message(data.message,false);
                            console.log(data);
                        }else if(data.status == true){
                            message("Data Updated successfully.",true);
                            loadTable();
                            $("#update_topicText").trigger("reset");
                        }
                    }
                });
            });
        
            // delete data
            $(document).on("click",".deleteBtn", function () {
                var delete_id = $(this).data("iddelete");//remember when giving name to a data attribute, it gives an error(undefine) when capital letters are used
                var obj = {id:delete_id};
                var Jdata = JSON.stringify(obj);
                var element = this; //use to hide when deleted

                if(confirm("Really Want to Delete ?")){
                    $.ajax({
                        url:"http://localhost/sdms/php_files/databaseApi_delete.php?api_del_id=2",
                        type:"DELETE",
                        data: Jdata,
                        success: function(data){
                            if(data.status == true){
                                $(element).closest("tr").fadeOut();
                                message("Data deleted successfully.",true);
                            }else{
                                message("Error not deleted, check console for more details.",false);
                                //alert(data.message + " error check console for more detail" );
                                console.log(data);
                            }
                        }
                    });
                }
            });

            //search data
            $("#searchBox").on("keyup", function(){
                var search1 = $("#searchBox").val();
                $("#tableData").html(""); 
                //console.log(search1);   
                $.ajax({
                    url: "http://localhost/sdms/php_files/databaseApi.php?api_id=8&search=" + search1,
                    type: "GET",
                    success: function(data){
                        //console.log(data);
                        if(data[0].status == false){
                            $("#tableData").append("<tr><td><h2>" + data[0].message + "</h2></td></tr>"); 
                        }else{
                            $.each(data, function(key, value){
                                $("#tableData").append("<tr><td>" + value.tid + "</td><td>" + value.title + "</td>"
                                    + "<td> <button class = 'updateBtn' data-idupdate = '" + value.tid + "'>Update</button> </td>" + "<td> <button class = 'deleteBtn' data-idDelete ='" + value.tid + "'>Delete</button> </td>" );
                            });
                        }
                    }
                });
            });

            //show more
            $("#more").on("click", function () {
                $("#two1").slideToggle(1000);
            });

            //hide update form
            $("#cancle").on("click", function () {
                $("#update_form").slideUp(1000);
            });

        });//ready
        

    </script>

</body>
</html>